name: Build and test
on:
  pull_request:
    branches:
      - master
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Install SSH key
        uses: shimataro/ssh-key-action@v1
        with:
          private-key: ${{ secrets.SSH_KEY }}
          known-hosts: github.com

      - name: Checkout
        uses: actions/checkout@v1

      - name: Build
        run: |
          git config --file=.gitmodules submodule.lib.url git@github.com:pucsbridge/test-libraries.git
          git submodule sync
          git submodule update --init
          mkdir -p out
          java_files=`find src/solution tests -name "*.java"`
          javac -cp lib/*:. -d out $java_files
          java -cp out/:lib/* com.github.drewsdav.barista.util.WeightCalc

      - name: Test
        run: |
            cp src/solution/* src/
            java_files=`find src -maxdepth 1 -name "*.java"`
            for value in $java_files; do sed -i -e '1d' $value; done
            java_files=`find src tests -name "*.java"`
            javac -cp lib/*:. -d out $java_files
            test_files=`find tests -type f -name "*.java" -exec basename {} \;`
            for value in $test_files; do tests+="${value%.*} "; done
            java -cp out/:lib/* org.junit.runner.JUnitCore $tests
